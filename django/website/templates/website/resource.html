{% load static %}
{% get_static_prefix as STATIC_PREFIX %}

<a class="anchor-set anchor-name" name="{{resource.id}}"></a>

{% if highlighted %}
<div class="callout resource-info highlighted-resource" data-resource-id="{{resource.id}}">
{% else %}
<div class="callout resource-info collapsed" data-resource-id="{{resource.id}}">
{% endif %}
    {# header / top section #}
    <div class="resource-header-row">      
        <div>
            <div class="resource_name">{{resource.name}}{% if resource.subtitle %}: {{resource.subtitle}}{% endif %}
            {% if resource.is_hosted and resource.version %}
                <span class="resource_version">{{resource.version}}</span>
            {% endif %}
            </div>
            <p class="resource_info">
            {{resource.credits|safe}}
            {% for category in resource.categories.all %}
                {% if not category.has_parents %}
                <label class="label {{category.abbreviation}}">
                    <input class="label {{category.abbreviation}} resource_info_label" type="checkbox" name="category_checkbox" value="{{category.id}}"
                    {% if category.id in selected_category_ids %} checked {% endif %} >
                    {{category.abbreviation}}
                </label>
                {% endif %}
            {% endfor %}
            </p>
        </div>
        <div class="icon-container">
            <div class="citation_id" data-tooltip title="Citation ID" data-alignment="right" data-position="bottom">
                <svg class="hide-for-small-only" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="104" height="20" role="img" aria-label="EMAC: 2209-002">
                    <title>EMAC: {{resource.citation_id}}</title>
                    <linearGradient id="s" x2="0" y2="100%">
                        <stop offset="0" stop-color="#bbb" stop-opacity=".1"/>
                        <stop offset="1" stop-opacity=".1"/>
                    </linearGradient>
                    <clipPath id="r">
                        <rect width="104" height="20" rx="3" fill="#fff"/>
                    </clipPath>
                    <g clip-path="url(#r)">
                        <rect width="41" height="20" fill="#555"/>
                        <rect x="41" width="63" height="20" fill="#007EC6"/>
                        <rect width="104" height="20" fill="url(#s)"/>
                    </g>
                    <g fill="#fff" text-anchor="middle" font-family="Verdana,Geneva,DejaVu Sans,sans-serif" text-rendering="geometricPrecision" font-size="110">
                        <text aria-hidden="true" x="215" y="150" fill="#010101" fill-opacity=".3" transform="scale(.1)" textLength="310">EMAC</text>
                        <text x="215" y="140" transform="scale(.1)" fill="#fff" textLength="310">EMAC</text>
                        <text aria-hidden="true" x="715" y="150" fill="#010101" fill-opacity=".3" transform="scale(.1)" textLength="530">{{resource.citation_id}}</text>
                        <text x="715" y="140" transform="scale(.1)" fill="#fff" textLength="530">{{resource.citation_id}}</text>
                    </g>
                </svg>
                <span class="show-for-small-only">{{resource.citation_id}}</span>
            </div>
            <div class="copy_img" data-tooltip tabindex="1" title="Copy link to clipboard" data-position="bottom" data-alignment="right">
                <img  class="copy-icon" src="/static/images/copy_clipboard.png" alt="Copy link">
            </div>
            <span class="copy_link">
                <a href="{{EMAC_PROTOCOL}}://{{EMAC_DOMAIN}}?cid={{resource.citation_id}}">{{EMAC_PROTOCOL}}://{{EMAC_DOMAIN}}?cid={{resource.citation_id}}</a>
            </span>
            <div class="feedback_img hide-for-small-only" data-tooltip tabindex="1" title="Feedback">
                <img class="feedback-icon" onclick="getResourceFeedback('{{resource.id}}')" src="/static/images/feedback.png" alt="feedback_img">
            </div>
        </div>
    </div>
    {# bottom section #}
    <div class="grid-x">
        {# description #}
        <div class="small-10 medium-9 large-9">
            <div class="resource_description">
            {% if resource.is_under_development %}
                WEB TOOL DEVELOPMENT IN PROGRESS &mdash;
            {% endif %}
            {{resource.description|safe}}
            </div>
            <div class="resource-details hide-for-small-only">
                <p class="resource_code">
                    Code Language(s): {{resource.code_languages|safe}}
                </p>
                <p class="resource_updated">
                    Last updated: {{resource.last_modification_date|date:'M. j, Y'}}
                </p>
                {% if resource.version %}
                <p class="resource-version">
                    Version: {{ resource.version }}
                </p>
                {% endif %}
                {% comment %}
                { if resource.github_release }
                <p class="github-notes">
                    GitHub release notes: {{ resource.github_release }}
                </p>
                { endif }
                {% endcomment %}
                {% if is_curator %}
                <p class="curated-date">
                    {% if resource.submission.last_curated_date %}
                    Last curated: {{resource.submission.last_curated_date|date:'M. j, Y'}}
                    {% else %}
                    Last curated: -
                    {% endif %}
                </p>
                <p class="curated-by">
                    {% if resource.submission.last_curated_by %}
                    Curated by: {{resource.submission.last_curated_by}}
                    {% else %}
                    Curated by: -
                    {% endif %}
                </p>
                {% endif %}
            </div>
        </div>
        {# logo section #}
        <div class="small-2 medium-3 large-3 logo_container hide-for-small-only">
            {% if resource.logo_image %}
                {% if resource.logo_link %}
                    <a href="{{resource.logo_link}}" id="{{resource.id}}_logo_link" class="logo_link">
                {% elif resource.about_link %}
                    <a href="{{resource.about_link}}" id="{{resource.id}}_logo_link" class="logo_link">
                {% endif %}
                    <img class="resource_logo" loading="lazy" src="{{STATIC_PREFIX}}{{resource.logo_image.url}}" alt="logo">
                {% if resource.logo_link or resource.about_link %}
                    </a>
                {% endif %}
            {% endif %}
        </div>
        {# buttons #}
        <div class="text-right small-12">
            {% if resource.about_link %}
                <a class="hollow button about_btn float-left" id="{{resource.id}}_about_link" href="{{resource.about_link}}" data-tooltip tabindex="1" title="Learn what the tool is used for and how to use it" data-position="bottom" data-alignment="right">About</a>
            {% endif %}
            {% if resource.demo_link %}
                <a class="hollow button alert float-left" id="{{resource.id}}_demo_link" href="{{resource.demo_link}}" data-tooltip tabindex="1" title="View a video demonstration of the basic use of the tool" target="_blank;" data-position="bottom" data-alignment="right">Demo</a>
            {% endif %}
            {% if resource.discuss_link %}
                <a class="hollow button float-left" id="{{resource.id}}_discuss_link" href="{{resource.discuss_link}}" data-tooltip tabindex="1" title="Discussion board for the tool: ask questions, leave suggestions, post problems, etc." data-position="bottom" data-alignment="right">Discuss</a>
            {% endif %}
            {% if resource.citation_count != None %}
                <a class="hollow button ads_btn float-left" id="{{resource.id}}_abstract_link" href="{{resource.ads_abstract_link}}" data-tooltip tabindex="1" title="The number of times the paper associated with this tool has been cited on ADS, if applicable." data-position="bottom" data-alignment="right">ADS: <span> {{resource.citation_count}} </span> </a>
            {% endif %}
            {% if resource.ascl_id %}
                <a class="hollow button ascl_btn float-left" id="{{resource.id}}_ascl_link" href="https://ascl.net/{{resource.ascl_id}}" data-tooltip tabindex="1" title="The entry for this resource in the Astrophysics Source Code Library." data-position="bottom" data-alignment="right">ASCL</a>
            {% endif %}
            
            {% if highlighted %}
                <a class="button reset_btn float-left reset_btn" href='/'>Reset</a>
            {% elif resource.related_resources.count %}
                <a class="hollow button related_btn float-left" data-open="modal-{{resource.id}}"
                    href='?related_resource={{resource.id}}' data-tooltip tabindex="1" title="See resources listed on EMAC that are related to this tool" data-position="bottom" data-alignment="right">Related</a>
            {% endif %}

            {% if is_curator %}
                {% if resource.submission.curator_lock == None or resource.submission.curator_lock == request.user %}
                <a class="hollow button float-left curate_btn hide-for-small-only" href="{{EMAC_PROTOCOL}}://{{EMAC_DOMAIN}}/curate?cid={{resource.citation_id}}" data-tooltip tabindex="1" title="Edit categories or collections for this resource" data-position="bottom" data-alignment="right">Curate</a>
                {% else %}
                <button class="hollow button float-left curate_btn hide-for-small-only" data-tooltip tabindex="1" title="Edits locked by another curator" data-position="bottom" data-alignment="right" disabled="true">Curate</button>
                {% endif %}
            {% endif %}
            
            {% if resource.download_link %}
                <a class="hollow button download_btn hide-for-small-only" id="{{resource.id}}_download_link" href="{{resource.download_link}}" data-tooltip tabindex="1" title="View and download the source code to run the tool locally" data-position="bottom" data-alignment="right">Code</a>
            {% endif %}
            {% if resource.download_data_link %}
                <a class="hollow button download_data_btn hide-for-small-only" id="{{resource.id}}_download_data_link" href="{{resource.download_data_link}}" data-tooltip tabindex="1" title="View and download output or input files for this resource" data-position="bottom" data-alignment="right">Data</a>
            {% endif %}
            {% if resource.jupyter_link %}
                <a class="hollow button jupyter_btn hide-for-small-only" id="{{resource.id}}_jupyter_link" href="{{resource.jupyter_link}}" data-tooltip tabindex="1" title="Interact with Jupyter Notebook tutorials" data-position="bottom" data-alignment="right">Jupyter</a>
            {% endif %}
            {% if resource.is_hosted %}
                {% if resource.subdomain and resource.path %}
                    <a class="hollow button launch_btn" id="{{resource.id}}_launch_link" href="{{EMAC_PROTOCOL}}://{{resource.subdomain}}.{{EMAC_DOMAIN}}{{resource.path}}" data-tooltip tabindex="1" title="Open the tool's web application" data-position="bottom" data-alignment="right">WebApp</a>
                {% elif resource.subdomain %}
                    <a class="hollow button launch_btn" id="{{resource.id}}_launch_link" href="{{EMAC_PROTOCOL}}://{{resource.subdomain}}.{{EMAC_DOMAIN}}" data-tooltip tabindex="1" title="Open the tool's web application" data-position="bottom" data-alignment="right">WebApp</a>
                {% elif resource.path %}
                    <a class="hollow button launch_btn" id="{{resource.id}}_launch_link" href="{{EMAC_PROTOCOL}}://{{EMAC_DOMAIN}}{{resource.path}}" data-tooltip tabindex="1" title="Open the tool's web application" data-position="bottom" data-alignment="right">WebApp</a>
                {% endif %}
            {% elif resource.launch_link %}
                <a class="hollow button launch_btn" id="{{resource.id}}_launch_link" href="{{resource.launch_link}}" data-tooltip tabindex="1" title="Open the tool's web application" data-position="bottom" data-alignment="right">WebApp</a>
            {% endif %}
        </div>
    </div>

    <div class="arrow">
        <i id="icon" class="fa fa-angle-down rotate"></i>
    </div>
</div>
    
<div class="child-category-list" data-resource-id="{{resource.id}}">
    {% for category in resource.categories.all %}
        {% if category.has_parents %}
            {% for parent in category.parents.all %}
                <div data-category="{{category.id}}" data-parent="{{parent.id}}"></div>
            {% endfor %}
        {% endif %}
    {% endfor %}
</div>
